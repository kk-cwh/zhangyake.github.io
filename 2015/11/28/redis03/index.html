<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="天空之城,zhangykvip@126.com"><title>redis命令学习(三) · THIS SPACE</title><meta name="description" content="有序集合(ZSet)操作命令　　Redis 有序集合与普通集合非常相似，是一个没有重复元素的字符串集合。不同之处是有序集合的每个成员都关联了一个评分，这个评分被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但评分可以重复。　　使用有序集合你可以以非常快的速度添加、删除和更新元素"><meta name="keywords" content="Hexo,HTML,CSS,php,Python,Node.js"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.gif" style="width:127px; border-radius: 100px;"><h3 title=""><a href="/">THIS SPACE</a></h3><div class="description"><p>live a good life.</p></div></div></div><ul class="social-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="http://weibo.com/http://weibo.com/jaakzh"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/https://github.com/zhangyake/"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=0 height=0 src="//music.163.com/outchain/player?type=2&id=410042763&auto=1&height=66"></iframe></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>redis命令学习(三)</a></h3></div><div class="post-content"><h4 id="有序集合-ZSet-操作命令"><a href="#有序集合-ZSet-操作命令" class="headerlink" title="有序集合(ZSet)操作命令"></a>有序集合(ZSet)操作命令</h4><p>　　Redis 有序集合与普通集合非常相似，是一个没有重复元素的字符串集合。不同之处是有序集合的每个成员都关联了一个评分，这个评分被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但评分可以重复。<br><a id="more"></a><br>　　使用有序集合你可以以非常快的速度添加、删除和更新元素。因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。<br>　　访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。在有序集合中，你可以很快捷的访问一切你需要的东西：有序的元素，快速的存在性测试，快速访问集合的中间元素！ 简而言之使用有序集合你可以做完成许多对性能有极端要求的任务，而那些任务使用其他类型的数据库真的是很难完成的。</p>
<h4 id="ZADD-命令-添加成员"><a href="#ZADD-命令-添加成员" class="headerlink" title="ZADD 命令 - 添加成员"></a>ZADD 命令 - 添加成员</h4><p>在redis中，使用ZADD命令将一个或多个 member 元素及其 score 值加入到有序集 key 当中<br>基本语法：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZADD <span class="built_in">key</span> score <span class="built_in">member</span> [[score <span class="built_in">member</span>] [score <span class="built_in">member</span>] ...]</div></pre></td></tr></table></figure></p>
<p>示例 - 添加google.com,baidu.com,sougou.com到website集合，评分5 , 4 , 3。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZADD</span> <span class="selector-tag">website</span> 5 <span class="selector-tag">google</span><span class="selector-class">.com</span> 4 <span class="selector-tag">baidu</span><span class="selector-class">.com</span> 3 <span class="selector-tag">sougou</span><span class="selector-class">.com</span>                      </div><div class="line">(<span class="selector-tag">integer</span>) 3</div></pre></td></tr></table></figure></p>
<p>如果某个 member 已经是有序集的成员，那么更新这个 member 的 score 值，并通过重新插入这个 member 元素，来保证该 member 在正确的位置上。<br>score 值可以是整数值或双精度浮点数。<br>如果 key 不存在，则创建一个空的有序集并执行ZADD操作。<br>当 key 存在但不是有序集类型时，返回一个错误。</p>
<h4 id="ZRANGE命令-获取指定区域成员"><a href="#ZRANGE命令-获取指定区域成员" class="headerlink" title="ZRANGE命令 - 获取指定区域成员"></a>ZRANGE命令 - 获取指定区域成员</h4><p>如果想要获取集合成员，可以使用ZRANGE命令<br>基本语法：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZRANGE key <span class="literal">start</span> <span class="literal">stop</span> [WITHSCORES]</div></pre></td></tr></table></figure></p>
<p>示例 - 获取website集合的全部成员。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGE website <span class="number">0</span> -<span class="number">1</span> WITHSCORES  <span class="comment"># 显示整个有序集成员                                      </span></div><div class="line"><span class="number">1</span>) <span class="string">"sougou.com"</span>                                                                </div><div class="line"><span class="number">2</span>) <span class="string">"3"</span>                                                           </div><div class="line"><span class="number">3</span>) <span class="string">"baidu.com"</span>                                                                 </div><div class="line"><span class="number">4</span>) <span class="string">"4"</span>                  </div><div class="line"><span class="number">5</span>) <span class="string">"google.com"</span></div><div class="line"><span class="number">6</span>) <span class="string">"5"</span></div></pre></td></tr></table></figure></p>
<p>返回的成员的位置按 score 值递增(从小到大)来排序。</p>
<h4 id="ZSCORE命令-获取成员评分"><a href="#ZSCORE命令-获取成员评分" class="headerlink" title="ZSCORE命令 - 获取成员评分"></a>ZSCORE命令 - 获取成员评分</h4><p>redis中使用ZSCORE命令来获取成员评分<br>基本语法：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZSCORE <span class="built_in">key</span> <span class="built_in">member</span></div></pre></td></tr></table></figure></p>
<p>示例 - 获取集合website中元素google.com的评分。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZSCORE</span> <span class="selector-tag">website</span> <span class="selector-tag">google</span><span class="selector-class">.com</span>  # 注意返回值是字符串</div><div class="line">"5"</div></pre></td></tr></table></figure></p>
<p>如果 google.com 是集合 website 的成员，则返回成员 google.com 的评分值。<br>如果 google.com 元素不是有序集 website 的成员，或 website 不存在，则返回 nil 。</p>
<h4 id="ZREM命令-移除成员"><a href="#ZREM命令-移除成员" class="headerlink" title="ZREM命令 - 移除成员"></a>ZREM命令 - 移除成员</h4><p>ZREM命令可以移除指定成员<br>基本语法：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZREM <span class="built_in">key</span> <span class="built_in">member</span> [<span class="built_in">member</span> ...]</div></pre></td></tr></table></figure></p>
<p>示例 - 移除website集合中google.com元素。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZREM</span> <span class="selector-tag">website</span> <span class="selector-tag">google</span><span class="selector-class">.com</span>    </div><div class="line">(<span class="selector-tag">integer</span>) 1</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">website</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">WITHSCORES</span>   #显示没有<span class="selector-tag">google</span><span class="selector-class">.com</span> </div><div class="line">1) "<span class="selector-tag">sougou</span><span class="selector-class">.com</span>"   </div><div class="line">2) "3" </div><div class="line">3) "<span class="selector-tag">baidu</span><span class="selector-class">.com</span>"                      </div><div class="line">4) "4"</div></pre></td></tr></table></figure></p>
<p>执行成功，google.com元素将从website集合中移除，如果google.com不存在，将被忽略。<br>如果 website 集合存在但不是有序集类型时，返回一个错误。</p>
<h4 id="ZCARD命令-获取成员数量"><a href="#ZCARD命令-获取成员数量" class="headerlink" title="ZCARD命令 - 获取成员数量"></a>ZCARD命令 - 获取成员数量</h4><p>如果需要查看集合成员的数量，那么我们需要使用到ZCARD命令<br>基本语法：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ZCARD key</span></div></pre></td></tr></table></figure></p>
<p>示例 - 查看website集合的成员数量。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZCARD</span> <span class="selector-tag">website</span></div><div class="line">(<span class="selector-tag">integer</span>) 2</div></pre></td></tr></table></figure></p>
<p>执行成功，将返回有序集 website 的成员总数。</p>
<h4 id="ZCOUNT命令-获取评分区域成员数量"><a href="#ZCOUNT命令-获取评分区域成员数量" class="headerlink" title="ZCOUNT命令 - 获取评分区域成员数量"></a>ZCOUNT命令 - 获取评分区域成员数量</h4><p>除了ZCARD命令以外，ZCOUNT命令也可以查看成员的数量，和前者不同的是，ZCOUNT命令可以设定评分的最小和最大值<br>基本语法：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZCOUNT <span class="built_in">key</span> <span class="built_in">min</span> <span class="built_in">max</span></div></pre></td></tr></table></figure></p>
<p>示例 - 查看评分在4-5之间的website。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZCOUNT</span> <span class="selector-tag">salary</span> 4 5  </div><div class="line">(<span class="selector-tag">integer</span>) 1</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">website</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">WITHSCORES</span>   # <span class="selector-tag">baidu</span><span class="selector-class">.com</span> 4        </div><div class="line">1) "<span class="selector-tag">sougou</span><span class="selector-class">.com</span>" </div><div class="line">2) "3" </div><div class="line">3) "<span class="selector-tag">baidu</span><span class="selector-class">.com</span>"   </div><div class="line">4) "4"</div></pre></td></tr></table></figure></p>
<p>执行成功，将返回有序集 key 中， score 值在 min 和 max 之间(默认包括 score 值等于 min 或 max )的成员的数量。</p>
<h4 id="ZRANK命令-排名"><a href="#ZRANK命令-排名" class="headerlink" title="ZRANK命令 - 排名"></a>ZRANK命令 - 排名</h4><p>ZRANK命令可以获取到给定元素在集合中的排名，排名依据 评分（score） 值递增(从小到大)顺序排列<br>基本语法：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ZRANK <span class="built_in">key</span> <span class="built_in">member</span></div></pre></td></tr></table></figure></p>
<p>示例 - 显示 baidu.com 的评分排名。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">website</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">WITHSCORES</span>                          </div><div class="line">1) "<span class="selector-tag">sougou</span><span class="selector-class">.com</span>"                                                    </div><div class="line">2) "3" </div><div class="line">3) "<span class="selector-tag">baidu</span><span class="selector-class">.com</span>"                                                   </div><div class="line">4) "4"</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANK</span> <span class="selector-tag">website</span> <span class="selector-tag">baidu</span><span class="selector-class">.com</span> </div><div class="line">(<span class="selector-tag">integer</span>) 1</div></pre></td></tr></table></figure>
<p>排名以 0 为底，也就是说， score 值最小的成员排名为 0 。<br>使用 ZREVRANK 命令可以获得成员按 score 值递减(从大到小)排列的排名。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZREVRANK</span> <span class="selector-tag">website</span> <span class="selector-tag">baidu</span><span class="selector-class">.com</span>     </div><div class="line">(<span class="selector-tag">integer</span>) 0                                </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">ZRANGE</span> <span class="selector-tag">website</span> 0 <span class="selector-tag">-1</span> <span class="selector-tag">WITHSCORES</span>        </div><div class="line">1) "<span class="selector-tag">sougou</span><span class="selector-class">.com</span>"                                            </div><div class="line">2) "3"                                   </div><div class="line">3) "<span class="selector-tag">baidu</span><span class="selector-class">.com</span>"                  </div><div class="line">4) "4"</div></pre></td></tr></table></figure></p>
<h4 id="ZINCRBY-命令-增量"><a href="#ZINCRBY-命令-增量" class="headerlink" title="ZINCRBY 命令 - 增量"></a>ZINCRBY 命令 - 增量</h4><p>ZINCRBY命令可以为给定的成员评分值加上增量<br>语法格式：<br><strong>ZINCRBY key increment member</strong><br>示例 - 为website集合中的baidu.com加分5。<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGE website <span class="number">0</span> -<span class="number">1</span> WITHSCORES                                  </div><div class="line"><span class="number">1</span>) <span class="string">"sougou.com"</span>                                            </div><div class="line"><span class="number">2</span>) <span class="string">"3"</span>                                                           </div><div class="line"><span class="number">3</span>) <span class="string">"baidu.com"</span>                                                         </div><div class="line"><span class="number">4</span>) <span class="string">"4"</span>  <span class="comment"># 原来 4</span></div><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZINCRBY website <span class="number">5</span> baidu.com   <span class="comment"># 加分5                       </span></div><div class="line"><span class="string">"9"</span></div><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGE website <span class="number">0</span> -<span class="number">1</span> WITHSCORES      </div><div class="line"><span class="number">1</span>) <span class="string">"sougou.com"</span>                                                </div><div class="line"><span class="number">2</span>) <span class="string">"3"</span>                                                          </div><div class="line"><span class="number">3</span>) <span class="string">"baidu.com"</span>                                                    </div><div class="line"><span class="number">4</span>) <span class="string">"9"</span>   <span class="comment"># 加后 9</span></div></pre></td></tr></table></figure></p>
<p>可以通过传递一个负数值 increment ，让 score 减去相应的值，比如 ZINCRBY key -5 member ，就是让 member 的 score 值减去 5 。<br>当 key 不存在，或 member 不是 key 的成员时， ZINCRBY key increment member 等同于 ZADD key increment member 。<br>当 key 不是有序集类型时，返回一个错误。<br>score 值可以是整数值或双精度浮点数。</p>
<h3 id="Key相关命令"><a href="#Key相关命令" class="headerlink" title="Key相关命令"></a>Key相关命令</h3><h4 id="KEYS命令-查找键"><a href="#KEYS命令-查找键" class="headerlink" title="KEYS命令 - 查找键"></a>KEYS命令 - 查找键</h4><p>Redis 的keys命令用于管理键。使用 Redis 的keys命令,查找所有符合给定模式 pattern 的 key 。<br>语法格式：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KEYS <span class="built_in">pattern</span></div></pre></td></tr></table></figure></p>
<p>示例 - 查找包含a的键。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">MSET</span> <span class="selector-tag">name</span> "<span class="selector-tag">zhang</span>" <span class="selector-tag">age</span> 24 <span class="selector-tag">sex</span> 1   #设置三个键值对                                             </div><div class="line"><span class="selector-tag">OK</span>                                                                             </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">KEYS</span> *<span class="selector-tag">a</span>*                                                       </div><div class="line">1) "<span class="selector-tag">age</span>"                                                              </div><div class="line">2) "<span class="selector-tag">name</span>"</div></pre></td></tr></table></figure></p>
<p>KEYS <em> 匹配数据库中所有 key 。<br>KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。<br>KEYS h</em>llo 匹配 hllo 和 heeeeello 等。<br>KEYS h[ae]llo 匹配 hello 和 hallo 。<br>特殊符号用 \ 隔开。</p>
<h4 id="EXISTS命令-判断key是否存在"><a href="#EXISTS命令-判断key是否存在" class="headerlink" title="EXISTS命令 - 判断key是否存在"></a>EXISTS命令 - 判断key是否存在</h4><p>EXISTS命令的作用是判断指定key是否存在<br>语法格式：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">EXISTS key</span></div></pre></td></tr></table></figure></p>
<p>示例 - 判断age是否存在。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">MSET</span> <span class="selector-tag">name</span> "<span class="selector-tag">zhang</span>" <span class="selector-tag">age</span> 24 <span class="selector-tag">sex</span> 1                         </div><div class="line"><span class="selector-tag">OK</span>                                         </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">age</span>                                                    </div><div class="line">(<span class="selector-tag">integer</span>) 1</div></pre></td></tr></table></figure></p>
<p>若 key 存在，返回 1 ，否则返回 0 </p>
<h4 id="MOVE命令-移动key"><a href="#MOVE命令-移动key" class="headerlink" title="MOVE命令 - 移动key"></a>MOVE命令 - 移动key</h4><p>MOVE命令的作用是将当前数据库的 key 移动到给定的数据库 db 当中<br>语法如下：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">MOVE</span> key <span class="keyword">db</span></div></pre></td></tr></table></figure></p>
<p>如果当前数据库(源数据库)和给定数据库(目标数据库)有相同名字的给定 key ，或者 key 不存在于当前数据库，那么 MOVE 没有任何效果。<br>因此，也可以利用这一特性，将 MOVE 当作锁(locking)原语(primitive)。<br>示例 - 将数据库0中的age，移动到数据库1。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">SELECT</span> 0   </div><div class="line"># <span class="selector-tag">redis</span>默认使用数据库0，为了清晰起见，这里再显式指定一次                       </div><div class="line"><span class="selector-tag">OK</span>                                       </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">MOVE</span> <span class="selector-tag">age</span> 1                               </div><div class="line">(<span class="selector-tag">integer</span>) 1  </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">age</span>                                                 </div><div class="line">(<span class="selector-tag">integer</span>) 0                                                                    </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">SELECT</span> 1                                                  </div><div class="line"><span class="selector-tag">OK</span>                                                                             </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span><span class="selector-attr">[1]</span>&gt; <span class="selector-tag">EXISTS</span> <span class="selector-tag">age</span>   </div><div class="line">#注意命令提示符变成127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span><span class="selector-attr">[1]</span> 表明正在使用数据库 1                                                                   </div><div class="line">(<span class="selector-tag">integer</span>) 1</div></pre></td></tr></table></figure></p>
<h4 id="RENAME命令-重命名"><a href="#RENAME命令-重命名" class="headerlink" title="RENAME命令 - 重命名"></a>RENAME命令 - 重命名</h4><p>RENAME命令可以将原有的 key 修改为新的key名称<br>语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RENAME</span> <span class="keyword">key</span> newkey</div></pre></td></tr></table></figure></p>
<p>示例 - 重命名name 为 lastname。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span>  <span class="selector-tag">name</span>     # 获取当前<span class="selector-tag">name</span>的值  </div><div class="line">"<span class="selector-tag">zhang</span>"                                                                        </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">RENAME</span> <span class="selector-tag">name</span> <span class="selector-tag">lastname</span> # 重命名<span class="selector-tag">name</span> 为 <span class="selector-tag">lastname</span>            </div><div class="line"><span class="selector-tag">OK</span>                                                                             </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span> <span class="selector-tag">name</span>   # 获取当前<span class="selector-tag">name</span>的值 已经不存在                       </div><div class="line">(<span class="selector-tag">nil</span>)</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span> <span class="selector-tag">lastname</span>                                                   </div><div class="line">"<span class="selector-tag">zhang</span>"</div></pre></td></tr></table></figure></p>
<p>当 key 和 newkey 相同，或者 key 不存在时，返回一个错误。<br>当 newkey 已经存在时， RENAME 命令将覆盖旧值。</p>
<h4 id="SORT命令-排序"><a href="#SORT命令-排序" class="headerlink" title="SORT命令 - 排序"></a>SORT命令 - 排序</h4><p>排序是很常见的需求，在 redis 中可以使用SORT命令来实现排序<br>语法格式：<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SORT key <span class="comment">[BY pattern]</span> <span class="comment">[LIMIT offset count]</span> <span class="comment">[GET pattern <span class="comment">[GET pattern ...]</span>]</span> <span class="comment">[ASC | DESC]</span> <span class="comment">[ALPHA]</span> <span class="comment">[STORE destination]</span></div></pre></td></tr></table></figure></p>
<p>示例 对一个number列表排序<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> LPUSH number <span class="number">6</span> <span class="number">2</span> <span class="number">5</span> <span class="number">9</span> <span class="number">1</span> <span class="number">3</span> <span class="number">8</span>                               </div><div class="line">(integer) <span class="number">7</span>                                                                    </div><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> SORT number                                                    </div><div class="line"><span class="number">1</span>) <span class="string">"1"</span>                                                                         </div><div class="line"><span class="number">2</span>) <span class="string">"2"</span>                                                                         </div><div class="line"><span class="number">3</span>) <span class="string">"3"</span>                                         </div><div class="line"><span class="number">4</span>) <span class="string">"5"</span>    </div><div class="line"><span class="number">5</span>) <span class="string">"6"</span>     </div><div class="line"><span class="number">6</span>) <span class="string">"8"</span> </div><div class="line"><span class="number">7</span>) <span class="string">"9"</span></div><div class="line"><span class="meta">127.0.0.1:6379&gt;</span> SORT number DESC   </div><div class="line"><span class="number">1</span>) <span class="string">"9"</span>            </div><div class="line"><span class="number">2</span>) <span class="string">"8"</span>    </div><div class="line"><span class="number">3</span>) <span class="string">"6"</span>   </div><div class="line"><span class="number">4</span>) <span class="string">"5"</span></div><div class="line"><span class="number">5</span>) <span class="string">"3"</span></div><div class="line"><span class="number">6</span>) <span class="string">"2"</span></div><div class="line"><span class="number">7</span>) <span class="string">"1"</span></div></pre></td></tr></table></figure></p>
<p>使用SORT命令，可以返回或保存给定列表、集合、有序集合 key 中经过排序的元素。<br>排序默认以数字作为对象，值被解释为双精度浮点数，然后进行比较。</p>
<h4 id="DUMP命令-序列化"><a href="#DUMP命令-序列化" class="headerlink" title="DUMP命令 - 序列化"></a>DUMP命令 - 序列化</h4><p>redis 支持序列化，使用DUMP命令来序列化给定key的值<br>语法如下：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">DUMP key</span></div></pre></td></tr></table></figure></p>
<p>示例 - 序列化name。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">SET</span> <span class="selector-tag">name</span> "<span class="selector-tag">jaak</span>"</div><div class="line"><span class="selector-tag">OK</span></div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span> <span class="selector-tag">name</span></div><div class="line">"<span class="selector-tag">jaak</span>"</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">DUMP</span> <span class="selector-tag">name</span></div><div class="line">"\<span class="selector-tag">x00</span>\<span class="selector-tag">x04jaak</span>\<span class="selector-tag">x06</span>\<span class="selector-tag">x00</span>\<span class="selector-tag">x02</span>\<span class="selector-tag">xd6</span>\<span class="selector-tag">xed3n</span>\<span class="selector-tag">x91d</span>\<span class="selector-tag">xe5</span>"</div></pre></td></tr></table></figure></p>
<p>执行DUMP命令序列化成功后，将返回被序列化的值，若key不存在，则返回 nil 。</p>
<h4 id="EXPIRE命令-设置生存时间"><a href="#EXPIRE命令-设置生存时间" class="headerlink" title="EXPIRE命令 - 设置生存时间"></a>EXPIRE命令 - 设置生存时间</h4><p>为key设置生存时间需要使用EXPIRE命令<br>语法格式：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">EXPIRE key seconds</span></div></pre></td></tr></table></figure></p>
<p>示例 - 设置name的过期时间为20秒。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span> <span class="selector-tag">name</span></div><div class="line">"<span class="selector-tag">jaak</span>" </div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">EXPIRE</span> <span class="selector-tag">name</span> 20</div><div class="line">(<span class="selector-tag">integer</span>) 1</div><div class="line"> # 20秒后执行</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">GET</span> <span class="selector-tag">name</span></div><div class="line">(<span class="selector-tag">nil</span>)</div></pre></td></tr></table></figure></p>
<p>为给定 key 设置生存时间，当 key 过期时(生存时间为 0 )，它会被自动删除。<br>在 Redis 中，带有生存时间的 key 被称为『易失的』(volatile)。</p>
<p>生存时间可以通过使用 DEL 命令来删除整个 key 来移除，或者被 SET 和 GETSET 命令覆写(overwrite)，这意味着，如果一个命令只是修改(alter)一个带生存时间的 key 的值而不是用一个新的 key 值来代替(replace)它的话，那么生存时间不会被改变。</p>
<h4 id="TTL命令-获取剩余生存时间"><a href="#TTL命令-获取剩余生存时间" class="headerlink" title="TTL命令 - 获取剩余生存时间"></a>TTL命令 - 获取剩余生存时间</h4><p>TTL命令的作用是获取给定 key 剩余生存时间(TTL, time to live)<br>语法格式：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">TTL  key</span></div></pre></td></tr></table></figure></p>
<p>示例 - 查看key剩余生存时间。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">EXPIRE</span> <span class="selector-tag">sex</span> 1000</div><div class="line">(<span class="selector-tag">integer</span>) 1</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-pseudo">:6379</span>&gt; <span class="selector-tag">TTL</span> <span class="selector-tag">key</span></div><div class="line">(<span class="selector-tag">integer</span>) 996</div></pre></td></tr></table></figure></p>
<p>当 key 不存在时，返回 -2 。 当 key 存在但没有设置剩余生存时间时，返回 -1 。 否则，以秒为单位，返回 key 的剩余生存时间</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2015-11-28</span><i class="fa fa-tag"></i><a href="/categories/数据库/" title="数据库" class="tag">数据库 </a><a href="/tags/redis/" title="redis" class="tag">redis </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://zhangyake.github.io/2015/11/28/redis03/,THIS SPACE,redis命令学习(三),;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2015/12/19/ecmascript01/" title="JavaScript类型转换" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2015/11/27/redis02/" title="redis命令学习(二)" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var cloudTieConfig = { url: document.location.href, sourceId: '2015/11/28/redis03/', productKey: 'zhangykvip@126.com', target: 'cloud-tie-wrapper' };var yunManualLoad = true;Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>